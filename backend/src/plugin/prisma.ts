import { PrismaClient } from '@prisma/client'
import Elysia from 'elysia'

export default () => (app: Elysia) =>
  app.derive(async ({ error }) => {
    try {
      const prisma = new PrismaClient({ log: process.env.NODE_ENV === 'test' ? [] : ['query'] })
      return { prisma }
    } catch (_) {
      return error(502)
    }
  })

export enum PrismaError {
  TOO_MANY_RECORDS = 'P2001',
  UNIQUE_CONSTRAINT_FAILED = 'P2002',
  FOREIGN_KEY_CONSTRAINT_FAILED = 'P2003',
  TOO_MANY_RELATIONS = 'P2004',
  TOO_MANY_RECURSION = 'P2005',
  CONNECTOR_ERROR = 'P2006',
  ACCESS_DENIED = 'P2007',
  NOT_IMPLEMENTED = 'P2008',
  LOCK_TIMEOUT = 'P2009',
  CONNECTION_LOST = 'P2010',
  SESSION_LOST = 'P2011',
  SESSION_EXPIRED = 'P2012',
  CONNECTION_FAILED = 'P2013',
  UNSUPPORTED_PROTOCOL = 'P2014',
  UNKNOWN_REQUEST = 'P2015',
  QUERY_TOO_LARGE = 'P2016',
  TIMED_OUT = 'P2017',
  CANCELLED = 'P2018',
  RECORD_NOT_FOUND = 'P2025',
  RECORD_ALREADY_EXISTS = 'P2026',
  RECORD_IN_USE = 'P2027',
  RECORD_TOO_LARGE = 'P2028',
  RECORD_DELETED = 'P2029',
  RECORD_LOCKED = 'P2030',
  RECORD_EXPIRED = 'P2031',
  RECORD_UNAVAILABLE = 'P2032',
  RECORD_MODIFIED = 'P2033',
  RECORD_NOT_MODIFIED = 'P2034',
  RECORD_NOT_DELETED = 'P2035',
  RECORD_NOT_LOCKED = 'P2036',
  RECORD_NOT_EXPIRED = 'P2037',
  RECORD_NOT_AVAILABLE = 'P2038',
  RECORD_NOT_FOUND_IN_CACHE = 'P2039',
  RECORD_NOT_FOUND_IN_DATABASE = 'P2040',
  RECORD_NOT_FOUND_IN_STORAGE = 'P2041',
  RECORD_NOT_FOUND_IN_MEMORY = 'P2042',
  RECORD_NOT_FOUND_IN_DISK = 'P2043',
  RECORD_NOT_FOUND_IN_FILE = 'P2044',
  RECORD_NOT_FOUND_IN_TABLE = 'P2045',
  RECORD_NOT_FOUND_IN_INDEX = 'P2046',
  INTERNAL_ERROR = 'P3000',
  DATA_EXCEPTION = 'P3001',
  CONSTRAINT_VIOLATION = 'P3002',
  INVALID_CURSOR_STATE = 'P3003',
  INVALID_TRANSACTION_STATE = 'P3004',
  ACTIVE_SQL_TRANSACTION = 'P3005',
  BRANCH_TRANSACTION_ALREADY_ACTIVE = 'P3006',
  HELD_CURSOR_REQUIRES_SAME_ISOLATION_LEVEL = 'P3007',
  INAPPROPRIATE_ACCESS_MODE_FOR_BRANCH_TRANSACTION = 'P3008',
  INAPPROPRIATE_ISOLATION_LEVEL_FOR_BRANCH_TRANSACTION = 'P3009',
  NO_ACTIVE_SQL_TRANSACTION_FOR_BRANCH_TRANSACTION = 'P3010',
  READ_ONLY_SQL_TRANSACTION = 'P3011',
  INVALID_ARGUMENT = 'P3012',
  INVALID_CURSOR = 'P3013',
  INVALID_FIELD = 'P3014',
  INVALID_FILTER = 'P3015',
  INVALID_FORMAT = 'P3016',
  INVALID_NAME = 'P3017',
  INVALID_ORDER = 'P3018',
  INVALID_PARAMETER = 'P3019',
  INVALID_RECURSION = 'P3020',
  INVALID_REFERENCE = 'P3021',
  INVALID_TYPE = 'P3022',
  INVALID_UNIQUE = 'P3023',
  INVALID_UPDATE = 'P3024',
}

export const POSTGRES_MAX_BIGINT = 9223372036854775807n
